var y=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var V=(e,t)=>{for(var o in t)y(e,o,{get:t[o],enumerable:!0})},J=(e,t,o,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of M(t))!N.call(e,i)&&i!==o&&y(e,i,{get:()=>t[i],enumerable:!(a=D(t,i))||a.enumerable});return e};var K=e=>J(y({},"__esModule",{value:!0}),e);var q={};V(q,{activate:()=>j});module.exports=K(q);var n=require("coc.nvim");async function O(e){let{nvim:t}=n.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}async function P(e){let t=null;if(n.workspace.isNvim){let o=await e.getVar("_copilot");o!=null&&o.suggestions&&(t=o.suggestions)}return n.workspace.isVim&&(t=await n.workspace.nvim.call("coc_copilot#get_suggestions")),t}function U(e,t,o,a){return new Promise(i=>{(async()=>{let l=await P(e);if(Array.isArray(l)&&(l==null?void 0:l.length)&&!t){i(l);return}if(t){let c=null,g=setTimeout(()=>{clearInterval(c),i([])},a);c=setInterval(async()=>{let s=await P(e);Array.isArray(s)&&(s==null?void 0:s.length)&&(clearTimeout(g),clearInterval(c),i(s))},500)}else return i(null)})()})}var j=async e=>{let t=n.workspace.getConfiguration("copilot"),o=t.get("enable",!0),a=t.get("kindLabel","\uF113\xA0"),i=t.get("priority",1e3),l=t.get("limit",10),c=t.get("enablePreselect",!0),g=t.get("shortcut","Cop"),s=t.get("autoUpdateCompletion",!0),k=t.get("triggerCharacters",[".","/","@"," ","*","<"]),x=t.get("keepCursorAfterCompletion",!1),I=t.get("timeout",5e3);if(!o)return;await O(e.extensionPath);let A={async provideCompletionItems(m,E,z,R){let{option:f}=R,b=null,w=[],L=await n.workspace.nvim.call("getbufvar",["","&filetype"]);if(f){let T=n.workspace.nvim.createBuffer(f.bufnr),v=f.input,C=await U(T,s,v,I);if(!C||C.length===0)return null;let d=v.length===0;C.forEach(({range:p,insertText:r})=>{let u=m.positionAt(m.offsetAt(E)),$=u.character-p.start.character,B=m.getText({start:{line:u.line,character:0},end:u}).replace(/\s/g,"").length>0,S=d?u:p.start,_={line:p.end.line,character:x?u.character:p.end.character},h=r.replace(new RegExp("^ +"),"");h=h.replace(/`/g,"\\`"),r=B&&d?r.replace(new RegExp(`^.{${$}}`),""):r,r=d?r.replace(new RegExp("^ +"),""):r,w.push({label:r.replace(/\n/g,"\u21B5"),kind:a,detail:"",documentation:{kind:n.MarkupKind.Markdown,value:`\`\`\`${L}
${h}
\`\`\``},textEdit:n.TextEdit.replace(n.Range.create(S,_),r),preselect:c})}),b={items:w.slice(0,l),isIncomplete:!!s}}return b}};e.subscriptions.push(n.languages.registerCompletionItemProvider("copilot",g,null,A,k,i))};0&&(module.exports={activate});
