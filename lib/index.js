var nt=Object.create;var P=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var it=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var at=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),lt=(e,t)=>{for(var n in t)P(e,n,{get:t[n],enumerable:!0})},J=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of it(t))!st.call(e,s)&&s!==n&&P(e,s,{get:()=>t[s],enumerable:!(r=rt(t,s))||r.enumerable});return e};var ct=(e,t,n)=>(n=e!=null?nt(ot(e)):{},J(t||!e||!e.__esModule?P(n,"default",{value:e,enumerable:!0}):n,e)),ut=e=>J(P({},"__esModule",{value:!0}),e);var W=at((bt,N)=>{"use strict";var ft=Object.prototype.hasOwnProperty,f="~";function x(){}Object.create&&(x.prototype=Object.create(null),new x().__proto__||(f=!1));function pt(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function V(e,t,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var l=new pt(n,r||e,s),o=f?f+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],l]:e._events[o].push(l):(e._events[o]=l,e._eventsCount++),e}function k(e,t){--e._eventsCount===0?e._events=new x:delete e._events[t]}function u(){this._events=new x,this._eventsCount=0}u.prototype.eventNames=function(){var t=[],n,r;if(this._eventsCount===0)return t;for(r in n=this._events)ft.call(n,r)&&t.push(f?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t};u.prototype.listeners=function(t){var n=f?f+t:t,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,l=r.length,o=new Array(l);s<l;s++)o[s]=r[s].fn;return o};u.prototype.listenerCount=function(t){var n=f?f+t:t,r=this._events[n];return r?r.fn?1:r.length:0};u.prototype.emit=function(t,n,r,s,l,o){var c=f?f+t:t;if(!this._events[c])return!1;var i=this._events[c],m=arguments.length,h,a;if(i.fn){switch(i.once&&this.removeListener(t,i.fn,void 0,!0),m){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,n),!0;case 3:return i.fn.call(i.context,n,r),!0;case 4:return i.fn.call(i.context,n,r,s),!0;case 5:return i.fn.call(i.context,n,r,s,l),!0;case 6:return i.fn.call(i.context,n,r,s,l,o),!0}for(a=1,h=new Array(m-1);a<m;a++)h[a-1]=arguments[a];i.fn.apply(i.context,h)}else{var I=i.length,g;for(a=0;a<I;a++)switch(i[a].once&&this.removeListener(t,i[a].fn,void 0,!0),m){case 1:i[a].fn.call(i[a].context);break;case 2:i[a].fn.call(i[a].context,n);break;case 3:i[a].fn.call(i[a].context,n,r);break;case 4:i[a].fn.call(i[a].context,n,r,s);break;default:if(!h)for(g=1,h=new Array(m-1);g<m;g++)h[g-1]=arguments[g];i[a].fn.apply(i[a].context,h)}}return!0};u.prototype.on=function(t,n,r){return V(this,t,n,r,!1)};u.prototype.once=function(t,n,r){return V(this,t,n,r,!0)};u.prototype.removeListener=function(t,n,r,s){var l=f?f+t:t;if(!this._events[l])return this;if(!n)return k(this,l),this;var o=this._events[l];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&k(this,l);else{for(var c=0,i=[],m=o.length;c<m;c++)(o[c].fn!==n||s&&!o[c].once||r&&o[c].context!==r)&&i.push(o[c]);i.length?this._events[l]=i.length===1?i[0]:i:k(this,l)}return this};u.prototype.removeAllListeners=function(t){var n;return t?(n=f?f+t:t,this._events[n]&&k(this,n)):(this._events=new x,this._eventsCount=0),this};u.prototype.off=u.prototype.removeListener;u.prototype.addListener=u.prototype.on;u.prefixed=f;u.EventEmitter=u;typeof N<"u"&&(N.exports=u)});var dt={};lt(dt,{activate:()=>vt});module.exports=ut(dt);var p=require("coc.nvim");var K=ct(W(),1);var U=K.default;var j=new U;async function mt(e){let{nvim:t}=p.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}async function q(e){let t=null;if(p.workspace.isNvim){let n=await e.getVar("_copilot");n!=null&&n.suggestions&&(t=n.suggestions)}return p.workspace.isVim&&(t=await p.workspace.nvim.call("coc_copilot#get_suggestions")),t}var A,M;function ht(e,t,n,r){return new Promise(s=>{function l(){s(null),clearTimeout(M),clearInterval(A),j.removeListener("abort",l)}(async()=>{let o=await q(e);if(Array.isArray(o)&&(o==null?void 0:o.length)&&!t){s(o);return}if(t)M=setTimeout(()=>{clearInterval(A),s([])},r),A=setInterval(async()=>{let c=await q(e);Array.isArray(c)&&(c==null?void 0:c.length)&&(clearTimeout(M),clearInterval(A),s(c))},500),j.addListener("abort",l);else return s(null)})()})}var gt=(e,t)=>e.startsWith(t)?"match":e.startsWith(t.replace(/^ +/,""))?"partial":"mismatch",vt=async e=>{let t=p.workspace.getConfiguration("copilot"),n=t.get("enable",!0),r=t.get("kindLabel","\uF113\xA0"),s=t.get("priority",1e3),l=t.get("limit",10),o=t.get("enablePreselect",!0),c=t.get("shortcut","Cop"),i=t.get("autoUpdateCompletion",!0),m=t.get("triggerCharacters",[".","/","@"," ","*","<"]),h=t.get("timeout",5e3),a=t.get("showRemainingText",!0);if(!n)return;await mt(e.extensionPath);let I={async provideCompletionItems(g,z,yt,F){let{option:C}=F,B=null,T=[],G=C==null?void 0:C.filetype;if(C){let H=p.workspace.nvim.createBuffer(C.bufnr),O=C.input;j.emit("abort");let S=await ht(H,i,O,h);if(!S||S.length===0||(S.forEach(({range:_,insertText:v})=>{let E=g.positionAt(g.offsetAt(z)),R=E.character,Q=R-O.length,D=g.getText({start:{line:E.line,character:0},end:E}),X=O.length===0&&D.trim()==="",w=gt(v,D);if(X&&(w="partial"),w==="mismatch")return;let L=0;switch(w){default:case"match":{L=0;break}case"partial":{L=R-_.start.character;break}}let Y=w==="partial"?E:_.start,Z={line:_.end.line,character:_.end.character},tt=v.split(`
`).map((d,b)=>b===0?d.slice(Q-L):d).join(`
`).replace(/(\n( ){2,})/g,"\u21B5 ").replace(/\n/g,"\u21B5").replace(/^ +/,""),et=v.split(`
`).map(d=>{var b;return((b=d.match(/^( +)/))==null?void 0:b[0].length)||0}).reduce((d,b)=>Math.min(d,b),1/0),$=v.split(`
`).map(d=>d.replace(new RegExp(`^ {${et}}`),"")).join(`
`),y=v.split(`
`)[0];a?y=y.replace(new RegExp(`^.{${R-L}}`),"").replace(/^ +/,""):y="",y=y?`\`\`\`txt
${y}
\`\`\`
***
\``:"",$=y+`\`\`\`${G}
${$}
\`\`\``,v=w==="partial"?v.replace(new RegExp("^ +"),""):v,T.push({label:tt,kind:r,detail:"",documentation:{kind:p.MarkupKind.Markdown,value:`${$}`},textEdit:p.TextEdit.replace(p.Range.create(Y,Z),v),preselect:o})}),!T.length))return null;B={items:T.slice(0,l),isIncomplete:!!i}}return B}};e.subscriptions.push(p.languages.registerCompletionItemProvider("copilot",c,null,I,m,s,void 0,!!i))};0&&(module.exports={activate});
