var h=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var V=(n,t)=>{for(var s in t)h(n,s,{get:t[s],enumerable:!0})},J=(n,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of S(t))!U.call(n,e)&&e!==s&&h(n,e,{get:()=>t[e],enumerable:!(o=N(t,e))||o.enumerable});return n};var K=n=>J(h({},"__esModule",{value:!0}),n);var G={};V(G,{activate:()=>F});module.exports=K(G);var i=require("coc.nvim"),I=[];function j(n){return n.map(s=>s.uuid).some(s=>!I.includes(s))}function q(n,t){let s=t[0].displayText,o=t[0].text;return s+n===o}function z(n,t,s){return new Promise(o=>{n.getVar("_copilot").then(e=>{var g;if(Array.isArray(e==null?void 0:e.suggestions)&&((g=e==null?void 0:e.suggestions)==null?void 0:g.length)&&j(e.suggestions)&&q(s,e.suggestions)){o(e.suggestions);return}if(t){let c=null,C=setTimeout(()=>{clearInterval(c),o([])},5e3);c=setInterval(async()=>{var p;let r=await n.getVar("_copilot");Array.isArray(r==null?void 0:r.suggestions)&&((p=r==null?void 0:r.suggestions)==null?void 0:p.length)&&(clearTimeout(C),clearInterval(c),o(r.suggestions))},500)}else return o(null)})})}var F=async n=>{let t=i.workspace.getConfiguration("copilot"),s=t.get("enable",!0),o=t.get("kindLabel","\uF113\xA0"),e=t.get("priority",1e3),g=t.get("limit",10),c=t.get("enablePreselect",!0),C=t.get("shortcut","Cop"),r=t.get("autoUpdateCompletion",!0),p=t.get("triggerCharacters",[".","/","@"," ","*"]);if(!s)return;let P={async provideCompletionItems(m,v,H,k){let{option:f}=k,x=null,y=[],w=await i.workspace.nvim.call("getbufvar",["","&filetype"]);if(f){let A=i.workspace.nvim.createBuffer(f.bufnr),b=f.input,d=await z(A,r,b);if(!d||d.length===0)return null;I=d.map(a=>a.uuid);let T=b.length===0;d.forEach(({range:a,text:l})=>{let u=m.positionAt(m.offsetAt(v)),E=u.character-a.start.character,L=m.getText({start:u,end:{line:u.line,character:9999}}),M=m.getText({start:{line:u.line,character:0},end:u}).replace(/\s/g,"").length>0,R=l.includes(`
`),B=T?u:a.start,$={line:a.end.line,character:R?a.end.character+L.length:a.end.character},D=l.replace(new RegExp("^ +"),"");l=M&&T?l.replace(new RegExp(`^.{${E}}`),""):l,y.push({label:l.replace(/\n/g,"\u21B5"),kind:o,detail:"",documentation:{kind:i.MarkupKind.Markdown,value:`\`\`\`${w}
${D}
\`\`\``},textEdit:i.TextEdit.replace(i.Range.create(B,$),l),preselect:c})}),x={items:y.slice(0,g),isIncomplete:!0}}return x}};n.subscriptions.push(i.languages.registerCompletionItemProvider("copilot",C,null,P,p,e))};0&&(module.exports={activate});
