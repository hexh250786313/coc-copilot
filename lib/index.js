var x=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var J=(t,e)=>{for(var n in e)x(t,n,{get:e[n],enumerable:!0})},K=(t,e,n,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of S(e))!V.call(t,s)&&s!==n&&x(t,s,{get:()=>e[s],enumerable:!(l=N(e,s))||l.enumerable});return t};var U=t=>K(x({},"__esModule",{value:!0}),t);var F={};J(F,{activate:()=>z});module.exports=U(F);var o=require("coc.nvim"),k=[];function _(t){return t.map(n=>n.uuid).some(n=>!k.includes(n))}function j(t,e){let n=e[0].displayText,l=e[0].text;return n+t===l}function q(t,e,n,l){return new Promise(s=>{t.getVar("_copilot").then(r=>{var p;if(Array.isArray(r==null?void 0:r.suggestions)&&((p=r==null?void 0:r.suggestions)==null?void 0:p.length)&&(_(r.suggestions)&&j(n,r.suggestions)||!e)){s(r.suggestions);return}if(e){let c=null,m=setTimeout(()=>{clearInterval(c),s([])},l);c=setInterval(async()=>{var d;let i=await t.getVar("_copilot");Array.isArray(i==null?void 0:i.suggestions)&&((d=i==null?void 0:i.suggestions)==null?void 0:d.length)&&(clearTimeout(m),clearInterval(c),s(i.suggestions))},500)}else return s(null)})})}var z=async t=>{let e=o.workspace.getConfiguration("copilot"),n=e.get("enable",!0),l=e.get("kindLabel","\uF113\xA0"),s=e.get("priority",1e3),r=e.get("limit",10),p=e.get("enablePreselect",!0),c=e.get("shortcut","Cop"),m=e.get("autoUpdateCompletion",!0),i=e.get("triggerCharacters",[".","/","@"," ","*","<"]),d=e.get("keepCursorAfterCompletion",!1),v=e.get("timeout",5e3);if(!n)return;let w={async provideCompletionItems(f,A,G,E){let{option:h}=E,T=null,I=[],L=await o.workspace.nvim.call("getbufvar",["","&filetype"]);if(h){let R=o.workspace.nvim.createBuffer(h.bufnr),P=h.input,C=await q(R,m,P,v);if(!C||C.length===0)return null;k=C.map(u=>u.uuid);let b=P.length===0;C.forEach(({range:u,text:a})=>{let g=f.positionAt(f.offsetAt(A)),B=g.character-u.start.character,M=f.getText({start:{line:g.line,character:0},end:g}).replace(/\s/g,"").length>0,$=b?g:u.start,D={line:u.end.line,character:d?g.character:u.end.character},y=a.replace(new RegExp("^ +"),"");y=y.replace(/`/g,"\\`"),a=M&&b?a.replace(new RegExp(`^.{${B}}`),""):a,a=b?a.replace(new RegExp("^ +"),""):a,I.push({label:a.replace(/\n/g,"\u21B5"),kind:l,detail:"",documentation:{kind:o.MarkupKind.Markdown,value:`\`\`\`${L}
${y}
\`\`\``},textEdit:o.TextEdit.replace(o.Range.create($,D),a),preselect:p})}),T={items:I.slice(0,r),isIncomplete:m}}return T}};t.subscriptions.push(o.languages.registerCompletionItemProvider("copilot",c,null,w,i,s))};0&&(module.exports={activate});
