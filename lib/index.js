var re=Object.create;var P=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var le=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ce=(n,e)=>{for(var t in e)P(n,t,{get:e[t],enumerable:!0})},W=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of oe(e))!ae.call(n,s)&&s!==t&&P(n,s,{get:()=>e[s],enumerable:!(r=ie(e,s))||r.enumerable});return n};var ue=(n,e,t)=>(t=n!=null?re(se(n)):{},W(e||!n||!n.__esModule?P(t,"default",{value:n,enumerable:!0}):t,n)),fe=n=>W(P({},"__esModule",{value:!0}),n);var q=le((xe,N)=>{"use strict";var pe=Object.prototype.hasOwnProperty,f="~";function E(){}Object.create&&(E.prototype=Object.create(null),new E().__proto__||(f=!1));function me(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function K(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var l=new me(t,r||n,s),o=f?f+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],l]:n._events[o].push(l):(n._events[o]=l,n._eventsCount++),n}function k(n,e){--n._eventsCount===0?n._events=new E:delete n._events[e]}function u(){this._events=new E,this._eventsCount=0}u.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)pe.call(t,r)&&e.push(f?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};u.prototype.listeners=function(e){var t=f?f+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,l=r.length,o=new Array(l);s<l;s++)o[s]=r[s].fn;return o};u.prototype.listenerCount=function(e){var t=f?f+e:e,r=this._events[t];return r?r.fn?1:r.length:0};u.prototype.emit=function(e,t,r,s,l,o){var c=f?f+e:e;if(!this._events[c])return!1;var i=this._events[c],g=arguments.length,d,a;if(i.fn){switch(i.once&&this.removeListener(e,i.fn,void 0,!0),g){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,t),!0;case 3:return i.fn.call(i.context,t,r),!0;case 4:return i.fn.call(i.context,t,r,s),!0;case 5:return i.fn.call(i.context,t,r,s,l),!0;case 6:return i.fn.call(i.context,t,r,s,l,o),!0}for(a=1,d=new Array(g-1);a<g;a++)d[a-1]=arguments[a];i.fn.apply(i.context,d)}else{var I=i.length,v;for(a=0;a<I;a++)switch(i[a].once&&this.removeListener(e,i[a].fn,void 0,!0),g){case 1:i[a].fn.call(i[a].context);break;case 2:i[a].fn.call(i[a].context,t);break;case 3:i[a].fn.call(i[a].context,t,r);break;case 4:i[a].fn.call(i[a].context,t,r,s);break;default:if(!d)for(v=1,d=new Array(g-1);v<g;v++)d[v-1]=arguments[v];i[a].fn.apply(i[a].context,d)}}return!0};u.prototype.on=function(e,t,r){return K(this,e,t,r,!1)};u.prototype.once=function(e,t,r){return K(this,e,t,r,!0)};u.prototype.removeListener=function(e,t,r,s){var l=f?f+e:e;if(!this._events[l])return this;if(!t)return k(this,l),this;var o=this._events[l];if(o.fn)o.fn===t&&(!s||o.once)&&(!r||o.context===r)&&k(this,l);else{for(var c=0,i=[],g=o.length;c<g;c++)(o[c].fn!==t||s&&!o[c].once||r&&o[c].context!==r)&&i.push(o[c]);i.length?this._events[l]=i.length===1?i[0]:i:k(this,l)}return this};u.prototype.removeAllListeners=function(e){var t;return e?(t=f?f+e:e,this._events[t]&&k(this,t)):(this._events=new E,this._eventsCount=0),this};u.prototype.off=u.prototype.removeListener;u.prototype.addListener=u.prototype.on;u.prefixed=f;u.EventEmitter=u;typeof N<"u"&&(N.exports=u)});var be={};ce(be,{activate:()=>ye});module.exports=fe(be);var p=require("coc.nvim");var z=ue(q(),1);var F=z.default;var j=new F;async function he(n){let{nvim:e}=p.workspace;(await e.getOption("runtimepath")).split(",").includes(n)||await e.command(`execute 'noa set rtp+='.fnameescape('${n.replace(/'/g,"''")}')`)}async function G(n){let e=null;if(p.workspace.isNvim){let t=await n.getVar("_copilot");t!=null&&t.suggestions&&(e=t.suggestions)}return p.workspace.isVim&&(e=await p.workspace.nvim.call("coc_copilot#get_suggestions")),e}function ge(n,e){let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];)t++;return t}var A,M;function ve(n,e,t,r){return new Promise(s=>{function l(){s(null),clearTimeout(M),clearInterval(A),j.removeListener("abort",l)}(async()=>{let o=await G(n);if(Array.isArray(o)&&(o==null?void 0:o.length)&&!e){s(o);return}if(e)M=setTimeout(()=>{clearInterval(A),s([])},r),A=setInterval(async()=>{let c=await G(n);Array.isArray(c)&&(c==null?void 0:c.length)&&(clearTimeout(M),clearInterval(A),s(c))},500),j.addListener("abort",l);else return s(null)})()})}var de=(n,e)=>n.startsWith(e)?"match":n.startsWith(e.replace(/^ +/,""))?"partial":"mismatch",ye=async n=>{let e=p.workspace.getConfiguration("copilot"),t=e.get("enable",!0),r=e.get("kindLabel","\uF113\xA0"),s=e.get("priority",1e3),l=e.get("limit",10),o=e.get("enablePreselect",!0),c=e.get("shortcut","Cop"),i=!1,g=[],d=e.get("timeout",5e3),a=e.get("showRemainingText",!0);if(!t)return;await he(n.extensionPath);let I={async provideCompletionItems(v,H,we,Q){let{option:y}=Q,B=null,O=[],U=y==null?void 0:y.filetype;if(y){let X=p.workspace.nvim.createBuffer(y.bufnr),S=y.input;j.emit("abort");let T=await ve(X,i,S,d);if(!T||T.length===0||(T.forEach(({range:x,insertText:m})=>{var V;let w=v.positionAt(v.offsetAt(H)),R=w.character,Y=R-S.length,D=v.getText({start:{line:w.line,character:0},end:w}),Z=S.length===0&&D.trim()==="",_=de(m,D);if(Z&&(_="partial"),_==="mismatch")return;let L=0;switch(_){default:case"match":{L=0;break}case"partial":{L=R-x.start.character;break}}let J=_==="partial"?w:x.start,ee={line:x.end.line,character:w.line===x.end.line?(V=v.lines[w.line])==null?void 0:V.length:x.end.character+3},te=m.split(`
`).map((h,C)=>C===0?h.slice(Y-L):h).join(`
`).replace(/(\n( ){2,})/g,"\u21B5 ").replace(/\n/g,"\u21B5").replace(/^ +/,""),ne=m.split(`
`).map(h=>{var C;return((C=h.match(/^( +)/))==null?void 0:C[0].length)||0}).reduce((h,C)=>Math.min(h,C),1/0),$=m.split(`
`).map(h=>h.replace(new RegExp(`^ {${ne}}`),"")).join(`
`),b=m.split(`
`)[0];if(a?b=b.replace(new RegExp(`^.{${R-L}}`),"").replace(/^ +/,""):b="",b=b?`\`\`\`txt
${b}
\`\`\`
***
\``:"",$=b+`\`\`\`${U}
${$}
\`\`\``,m=_==="partial"?m.replace(new RegExp("^ +"),""):m,y.input.length===0){let h=ge(m,y.line);h>0&&(m=m.slice(h),J.character=h)}O.push({label:te,kind:r,detail:"",documentation:{kind:p.MarkupKind.Markdown,value:`${$}`},textEdit:p.TextEdit.replace(p.Range.create(J,ee),m),preselect:o})}),!O.length))return null;B={items:O.slice(0,l),isIncomplete:!!i}}return B}};n.subscriptions.push(p.languages.registerCompletionItemProvider("copilot",c,null,I,g,s,void 0,!!i))};0&&(module.exports={activate});
