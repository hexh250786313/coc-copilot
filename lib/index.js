var x=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var J=(n,t)=>{for(var s in t)x(n,s,{get:t[s],enumerable:!0})},K=(n,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of S(t))!V.call(n,e)&&e!==s&&x(n,e,{get:()=>t[e],enumerable:!(r=N(t,e))||r.enumerable});return n};var U=n=>K(x({},"__esModule",{value:!0}),n);var G={};J(G,{activate:()=>F});module.exports=U(G);var i=require("coc.nvim"),P=[];function j(n){return n.map(s=>s.uuid).some(s=>!P.includes(s))}function q(n,t){let s=t[0].displayText,r=t[0].text;return s+n===r}function z(n,t,s){return new Promise(r=>{n.getVar("_copilot").then(e=>{var g;if(Array.isArray(e==null?void 0:e.suggestions)&&((g=e==null?void 0:e.suggestions)==null?void 0:g.length)&&(j(e.suggestions)&&q(s,e.suggestions)||!t)){r(e.suggestions);return}if(t){let c=null,C=setTimeout(()=>{clearInterval(c),r([])},5e3);c=setInterval(async()=>{var p;let o=await n.getVar("_copilot");Array.isArray(o==null?void 0:o.suggestions)&&((p=o==null?void 0:o.suggestions)==null?void 0:p.length)&&(clearTimeout(C),clearInterval(c),r(o.suggestions))},500)}else return r(null)})})}var F=async n=>{let t=i.workspace.getConfiguration("copilot"),s=t.get("enable",!0),r=t.get("kindLabel","\uF113\xA0"),e=t.get("priority",1e3),g=t.get("limit",10),c=t.get("enablePreselect",!0),C=t.get("shortcut","Cop"),o=t.get("autoUpdateCompletion",!0),p=t.get("triggerCharacters",[".","/","@"," ","*","<"]);if(!s)return;let v={async provideCompletionItems(m,k,H,w){let{option:f}=w,y=null,b=[],A=await i.workspace.nvim.call("getbufvar",["","&filetype"]);if(f){let E=i.workspace.nvim.createBuffer(f.bufnr),T=f.input,d=await z(E,o,T);if(!d||d.length===0)return null;P=d.map(a=>a.uuid);let I=T.length===0;d.forEach(({range:a,text:l})=>{let u=m.positionAt(m.offsetAt(k)),L=u.character-a.start.character,M=m.getText({start:u,end:{line:u.line,character:9999}}),R=m.getText({start:{line:u.line,character:0},end:u}).replace(/\s/g,"").length>0,B=l.includes(`
`),$=I?u:a.start,D={line:a.end.line,character:B?a.end.character+M.length:a.end.character},h=l.replace(new RegExp("^ +"),"");h=h.replace(/`/g,"\\`"),l=R&&I?l.replace(new RegExp(`^.{${L}}`),""):l,b.push({label:l.replace(/\n/g,"\u21B5"),kind:r,detail:"",documentation:{kind:i.MarkupKind.Markdown,value:`\`\`\`${A}
${h}
\`\`\``},textEdit:i.TextEdit.replace(i.Range.create($,D),l),preselect:c})}),y={items:b.slice(0,g),isIncomplete:o}}return y}};n.subscriptions.push(i.languages.registerCompletionItemProvider("copilot",C,null,v,p,e))};0&&(module.exports={activate});
