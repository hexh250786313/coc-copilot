var W=Object.create;var w=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,tt=Object.prototype.hasOwnProperty;var et=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nt=(e,t)=>{for(var n in t)w(e,n,{get:t[n],enumerable:!0})},$=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Y(t))!tt.call(e,i)&&i!==n&&w(e,i,{get:()=>t[i],enumerable:!(r=X(t,i))||r.enumerable});return e};var rt=(e,t,n)=>(n=e!=null?W(Z(e)):{},$(t||!e||!e.__esModule?w(n,"default",{value:e,enumerable:!0}):n,e)),ot=e=>$(w({},"__esModule",{value:!0}),e);var J=et((gt,A)=>{"use strict";var st=Object.prototype.hasOwnProperty,p="~";function y(){}Object.create&&(y.prototype=Object.create(null),new y().__proto__||(p=!1));function it(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function D(e,t,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var c=new it(n,r||e,i),s=p?p+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],c]:e._events[s].push(c):(e._events[s]=c,e._eventsCount++),e}function b(e,t){--e._eventsCount===0?e._events=new y:delete e._events[t]}function f(){this._events=new y,this._eventsCount=0}f.prototype.eventNames=function(){var t=[],n,r;if(this._eventsCount===0)return t;for(r in n=this._events)st.call(n,r)&&t.push(p?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t};f.prototype.listeners=function(t){var n=p?p+t:t,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,c=r.length,s=new Array(c);i<c;i++)s[i]=r[i].fn;return s};f.prototype.listenerCount=function(t){var n=p?p+t:t,r=this._events[n];return r?r.fn?1:r.length:0};f.prototype.emit=function(t,n,r,i,c,s){var u=p?p+t:t;if(!this._events[u])return!1;var o=this._events[u],m=arguments.length,g,a;if(o.fn){switch(o.once&&this.removeListener(t,o.fn,void 0,!0),m){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,n),!0;case 3:return o.fn.call(o.context,n,r),!0;case 4:return o.fn.call(o.context,n,r,i),!0;case 5:return o.fn.call(o.context,n,r,i,c),!0;case 6:return o.fn.call(o.context,n,r,i,c,s),!0}for(a=1,g=new Array(m-1);a<m;a++)g[a-1]=arguments[a];o.fn.apply(o.context,g)}else{var x=o.length,v;for(a=0;a<x;a++)switch(o[a].once&&this.removeListener(t,o[a].fn,void 0,!0),m){case 1:o[a].fn.call(o[a].context);break;case 2:o[a].fn.call(o[a].context,n);break;case 3:o[a].fn.call(o[a].context,n,r);break;case 4:o[a].fn.call(o[a].context,n,r,i);break;default:if(!g)for(v=1,g=new Array(m-1);v<m;v++)g[v-1]=arguments[v];o[a].fn.apply(o[a].context,g)}}return!0};f.prototype.on=function(t,n,r){return D(this,t,n,r,!1)};f.prototype.once=function(t,n,r){return D(this,t,n,r,!0)};f.prototype.removeListener=function(t,n,r,i){var c=p?p+t:t;if(!this._events[c])return this;if(!n)return b(this,c),this;var s=this._events[c];if(s.fn)s.fn===n&&(!i||s.once)&&(!r||s.context===r)&&b(this,c);else{for(var u=0,o=[],m=s.length;u<m;u++)(s[u].fn!==n||i&&!s[u].once||r&&s[u].context!==r)&&o.push(s[u]);o.length?this._events[c]=o.length===1?o[0]:o:b(this,c)}return this};f.prototype.removeAllListeners=function(t){var n;return t?(n=p?p+t:t,this._events[n]&&b(this,n)):(this._events=new y,this._eventsCount=0),this};f.prototype.off=f.prototype.removeListener;f.prototype.addListener=f.prototype.on;f.prefixed=p;f.EventEmitter=f;typeof A<"u"&&(A.exports=f)});var ut={};nt(ut,{activate:()=>lt});module.exports=ot(ut);var l=require("coc.nvim");var M=rt(J(),1);var V=M.default;var T=new V;async function at(e){let{nvim:t}=l.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}async function j(e){let t=null;if(l.workspace.isNvim){let n=await e.getVar("_copilot");n!=null&&n.suggestions&&(t=n.suggestions)}return l.workspace.isVim&&(t=await l.workspace.nvim.call("coc_copilot#get_suggestions")),t}var _,O;function ct(e,t,n,r){return new Promise(i=>{function c(){i(null),clearTimeout(O),clearInterval(_),T.removeListener("abort",c)}(async()=>{let s=await j(e);if(Array.isArray(s)&&(s==null?void 0:s.length)&&!t){i(s);return}if(t)O=setTimeout(()=>{clearInterval(_),i([])},r),_=setInterval(async()=>{let u=await j(e);Array.isArray(u)&&(u==null?void 0:u.length)&&(clearTimeout(O),clearInterval(_),i(u))},500),T.addListener("abort",c);else return i(null)})()})}var S={statusItem:l.window.createStatusBarItem(10,{progress:!0})},lt=async e=>{let t=l.workspace.getConfiguration("copilot"),n=t.get("enable",!0),r=t.get("kindLabel","\uF113\xA0"),i=t.get("priority",1e3),c=t.get("limit",10),s=t.get("enablePreselect",!0),u=t.get("shortcut","Cop"),o=t.get("autoUpdateCompletion",!0),m=t.get("triggerCharacters",[".","/","@"," ","*","<"]),g=t.get("keepCursorAfterCompletion",!1),a=t.get("timeout",5e3),x=t.get("showStatus",!1);if(!n)return;await at(e.extensionPath),S.statusItem.text="Copilot: Fetching...",S.statusItem.isProgress=!0;let v={async provideCompletionItems(E,F,ft,K){let{option:P}=K,R=null,N=[],U=await l.workspace.nvim.call("getbufvar",["","&filetype"]);if(P){let q=l.workspace.nvim.createBuffer(P.bufnr),B=P.input;T.emit("abort");let I=await ct(q,o,B,a);if(x&&S.statusItem.hide(),!I||I.length===0)return null;let k=B.length===0;I.forEach(({range:C,insertText:h})=>{let d=E.positionAt(E.offsetAt(F)),z=d.character-C.start.character,G=E.getText({start:{line:d.line,character:0},end:d}).replace(/\s/g,"").length>0,H=k?d:C.start,Q={line:C.end.line,character:g?d.character:C.end.character},L=h.replace(new RegExp("^ +"),"");L=L.replace(/`/g,"\\`"),h=G&&k?h.replace(new RegExp(`^.{${z}}`),""):h,h=k?h.replace(new RegExp("^ +"),""):h,N.push({label:h.replace(/\n/g,"\u21B5"),kind:r,detail:"",documentation:{kind:l.MarkupKind.Markdown,value:`\`\`\`${U}
${L}
\`\`\``},textEdit:l.TextEdit.replace(l.Range.create(H,Q),h),preselect:s})}),R={items:N.slice(0,c),isIncomplete:!!o}}return R}};e.subscriptions.push(l.languages.registerCompletionItemProvider("copilot",u,null,v,m,i))};0&&(module.exports={activate});
