var y=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var J=(e,t)=>{for(var n in t)y(e,n,{get:t[n],enumerable:!0})},K=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of V(t))!_.call(e,i)&&i!==n&&y(e,i,{get:()=>t[i],enumerable:!(s=D(t,i))||s.enumerable});return e};var O=e=>K(y({},"__esModule",{value:!0}),e);var G={};J(G,{activate:()=>F});module.exports=O(G);var o=require("coc.nvim"),P=[];function U(e){return e.map(n=>n.uuid).some(n=>!P.includes(n))}function j(e,t){let n=t[0].displayText,s=t[0].text;return n+e===s}async function q(e){let{nvim:t}=o.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}async function v(e){let t=null;if(o.workspace.isNvim){let n=await e.getVar("_copilot");n!=null&&n.suggestions&&(t=n.suggestions)}return o.workspace.isVim&&(t=await o.workspace.nvim.call("coc_copilot#get_suggestions")),t}function z(e,t,n,s){return new Promise(i=>{(async()=>{let r=await v(e);if(Array.isArray(r)&&(r==null?void 0:r.length)&&(U(r)&&j(n,r)||!t)){i(r);return}if(t){let u=null,m=setTimeout(()=>{clearInterval(u),i([])},s);u=setInterval(async()=>{let l=await v(e);Array.isArray(l)&&(l==null?void 0:l.length)&&(clearTimeout(m),clearInterval(u),i(l))},500)}else return i(null)})()})}var F=async e=>{let t=o.workspace.getConfiguration("copilot"),n=t.get("enable",!0),s=t.get("kindLabel","\uF113\xA0"),i=t.get("priority",1e3),r=t.get("limit",10),u=t.get("enablePreselect",!0),m=t.get("shortcut","Cop"),l=t.get("autoUpdateCompletion",!0),T=t.get("triggerCharacters",[".","/","@"," ","*","<"]),I=t.get("keepCursorAfterCompletion",!1),k=t.get("timeout",5e3);if(!n)return;await q(e.extensionPath);let A={async provideCompletionItems(d,E,H,R){let{option:f}=R,b=null,x=[],L=await o.workspace.nvim.call("getbufvar",["","&filetype"]);if(f){let $=o.workspace.nvim.createBuffer(f.bufnr),w=f.input,g=await z($,l,w,k);if(!g||g.length===0)return null;P=g.map(c=>c.uuid);let C=w.length===0;g.forEach(({range:c,text:a})=>{let p=d.positionAt(d.offsetAt(E)),B=p.character-c.start.character,M=d.getText({start:{line:p.line,character:0},end:p}).replace(/\s/g,"").length>0,N=C?p:c.start,S={line:c.end.line,character:I?p.character:c.end.character},h=a.replace(new RegExp("^ +"),"");h=h.replace(/`/g,"\\`"),a=M&&C?a.replace(new RegExp(`^.{${B}}`),""):a,a=C?a.replace(new RegExp("^ +"),""):a,x.push({label:a.replace(/\n/g,"\u21B5"),kind:s,detail:"",documentation:{kind:o.MarkupKind.Markdown,value:`\`\`\`${L}
${h}
\`\`\``},textEdit:o.TextEdit.replace(o.Range.create(N,S),a),preselect:u})}),b={items:x.slice(0,r),isIncomplete:!!l}}return b}};e.subscriptions.push(o.languages.registerCompletionItemProvider("copilot",m,null,A,T,i))};0&&(module.exports={activate});
