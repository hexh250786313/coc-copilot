var w=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var J=(e,t)=>{for(var o in t)w(e,o,{get:t[o],enumerable:!0})},K=(e,t,o,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of V(t))!F.call(e,i)&&i!==o&&w(e,i,{get:()=>t[i],enumerable:!(a=N(t,i))||a.enumerable});return e};var O=e=>K(w({},"__esModule",{value:!0}),e);var z={};J(z,{activate:()=>q});module.exports=O(z);var n=require("coc.nvim");async function U(e){let{nvim:t}=n.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}async function x(e){let t=null;if(n.workspace.isNvim){let o=await e.getVar("_copilot");o!=null&&o.suggestions&&(t=o.suggestions)}return n.workspace.isVim&&(t=await n.workspace.nvim.call("coc_copilot#get_suggestions")),t}function j(e,t,o,a){return new Promise(i=>{(async()=>{let l=await x(e);if(Array.isArray(l)&&(l==null?void 0:l.length)&&!t){i(l);return}if(t){let c=null,m=setTimeout(()=>{clearInterval(c),i([])},a);c=setInterval(async()=>{let r=await x(e);Array.isArray(r)&&(r==null?void 0:r.length)&&(clearTimeout(m),clearInterval(c),i(r))},500)}else return i(null)})()})}var g={statusItem:n.window.createStatusBarItem(10,{progress:!0})},q=async e=>{let t=n.workspace.getConfiguration("copilot"),o=t.get("enable",!0),a=t.get("kindLabel","\uF113\xA0"),i=t.get("priority",1e3),l=t.get("limit",10),c=t.get("enablePreselect",!0),m=t.get("shortcut","Cop"),r=t.get("autoUpdateCompletion",!0),k=t.get("triggerCharacters",[".","/","@"," ","*","<"]),A=t.get("keepCursorAfterCompletion",!1),E=t.get("timeout",5e3),b=t.get("showStatus",!1);if(!o)return;await U(e.extensionPath),g.statusItem.text="Copilot: Fetching...",g.statusItem.isProgress=!0;let R={async provideCompletionItems(f,S,G,L){let{option:C}=L,I=null,P=[],B=await n.workspace.nvim.call("getbufvar",["","&filetype"]);if(C){let T=n.workspace.nvim.createBuffer(C.bufnr),v=C.input;b&&g.statusItem.show();let d=await j(T,r,v,E);if(b&&g.statusItem.hide(),!d||d.length===0)return null;let h=v.length===0;d.forEach(({range:p,insertText:s})=>{let u=f.positionAt(f.offsetAt(S)),$=u.character-p.start.character,_=f.getText({start:{line:u.line,character:0},end:u}).replace(/\s/g,"").length>0,D=h?u:p.start,M={line:p.end.line,character:A?u.character:p.end.character},y=s.replace(new RegExp("^ +"),"");y=y.replace(/`/g,"\\`"),s=_&&h?s.replace(new RegExp(`^.{${$}}`),""):s,s=h?s.replace(new RegExp("^ +"),""):s,P.push({label:s.replace(/\n/g,"\u21B5"),kind:a,detail:"",documentation:{kind:n.MarkupKind.Markdown,value:`\`\`\`${B}
${y}
\`\`\``},textEdit:n.TextEdit.replace(n.Range.create(D,M),s),preselect:c})}),I={items:P.slice(0,l),isIncomplete:!!r}}return I}};e.subscriptions.push(n.languages.registerCompletionItemProvider("copilot",m,null,R,k,i))};0&&(module.exports={activate});
