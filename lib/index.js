var nt=Object.create;var P=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var it=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var at=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),lt=(n,t)=>{for(var e in t)P(n,e,{get:t[e],enumerable:!0})},V=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of it(t))!st.call(n,s)&&s!==e&&P(n,s,{get:()=>t[s],enumerable:!(r=rt(t,s))||r.enumerable});return n};var ct=(n,t,e)=>(e=n!=null?nt(ot(n)):{},V(t||!n||!n.__esModule?P(e,"default",{value:n,enumerable:!0}):e,n)),ut=n=>V(P({},"__esModule",{value:!0}),n);var K=at((Ct,N)=>{"use strict";var ft=Object.prototype.hasOwnProperty,f="~";function _(){}Object.create&&(_.prototype=Object.create(null),new _().__proto__||(f=!1));function pt(n,t,e){this.fn=n,this.context=t,this.once=e||!1}function W(n,t,e,r,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var l=new pt(e,r||n,s),o=f?f+t:t;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],l]:n._events[o].push(l):(n._events[o]=l,n._eventsCount++),n}function k(n,t){--n._eventsCount===0?n._events=new _:delete n._events[t]}function u(){this._events=new _,this._eventsCount=0}u.prototype.eventNames=function(){var t=[],e,r;if(this._eventsCount===0)return t;for(r in e=this._events)ft.call(e,r)&&t.push(f?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};u.prototype.listeners=function(t){var e=f?f+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,l=r.length,o=new Array(l);s<l;s++)o[s]=r[s].fn;return o};u.prototype.listenerCount=function(t){var e=f?f+t:t,r=this._events[e];return r?r.fn?1:r.length:0};u.prototype.emit=function(t,e,r,s,l,o){var c=f?f+t:t;if(!this._events[c])return!1;var i=this._events[c],g=arguments.length,v,a;if(i.fn){switch(i.once&&this.removeListener(t,i.fn,void 0,!0),g){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,e),!0;case 3:return i.fn.call(i.context,e,r),!0;case 4:return i.fn.call(i.context,e,r,s),!0;case 5:return i.fn.call(i.context,e,r,s,l),!0;case 6:return i.fn.call(i.context,e,r,s,l,o),!0}for(a=1,v=new Array(g-1);a<g;a++)v[a-1]=arguments[a];i.fn.apply(i.context,v)}else{var I=i.length,d;for(a=0;a<I;a++)switch(i[a].once&&this.removeListener(t,i[a].fn,void 0,!0),g){case 1:i[a].fn.call(i[a].context);break;case 2:i[a].fn.call(i[a].context,e);break;case 3:i[a].fn.call(i[a].context,e,r);break;case 4:i[a].fn.call(i[a].context,e,r,s);break;default:if(!v)for(d=1,v=new Array(g-1);d<g;d++)v[d-1]=arguments[d];i[a].fn.apply(i[a].context,v)}}return!0};u.prototype.on=function(t,e,r){return W(this,t,e,r,!1)};u.prototype.once=function(t,e,r){return W(this,t,e,r,!0)};u.prototype.removeListener=function(t,e,r,s){var l=f?f+t:t;if(!this._events[l])return this;if(!e)return k(this,l),this;var o=this._events[l];if(o.fn)o.fn===e&&(!s||o.once)&&(!r||o.context===r)&&k(this,l);else{for(var c=0,i=[],g=o.length;c<g;c++)(o[c].fn!==e||s&&!o[c].once||r&&o[c].context!==r)&&i.push(o[c]);i.length?this._events[l]=i.length===1?i[0]:i:k(this,l)}return this};u.prototype.removeAllListeners=function(t){var e;return t?(e=f?f+t:t,this._events[e]&&k(this,e)):(this._events=new _,this._eventsCount=0),this};u.prototype.off=u.prototype.removeListener;u.prototype.addListener=u.prototype.on;u.prefixed=f;u.EventEmitter=u;typeof N<"u"&&(N.exports=u)});var yt={};lt(yt,{activate:()=>dt});module.exports=ut(yt);var p=require("coc.nvim");var q=ct(K(),1);var z=q.default;var j=new z;async function mt(n){let{nvim:t}=p.workspace;(await t.getOption("runtimepath")).split(",").includes(n)||await t.command(`execute 'noa set rtp+='.fnameescape('${n.replace(/'/g,"''")}')`)}async function F(n){let t=null;if(p.workspace.isNvim){let e=await n.getVar("_copilot");e!=null&&e.suggestions&&(t=e.suggestions)}return p.workspace.isVim&&(t=await p.workspace.nvim.call("coc_copilot#get_suggestions")),t}function ht(n,t){let e=0;for(;e<n.length&&e<t.length&&n[e]===t[e];)e++;return e}var A,M;function gt(n,t,e,r){return new Promise(s=>{function l(){s(null),clearTimeout(M),clearInterval(A),j.removeListener("abort",l)}(async()=>{let o=await F(n);if(Array.isArray(o)&&(o==null?void 0:o.length)&&!t){s(o);return}if(t)M=setTimeout(()=>{clearInterval(A),s([])},r),A=setInterval(async()=>{let c=await F(n);Array.isArray(c)&&(c==null?void 0:c.length)&&(clearTimeout(M),clearInterval(A),s(c))},500),j.addListener("abort",l);else return s(null)})()})}var vt=(n,t)=>n.startsWith(t)?"match":n.startsWith(t.replace(/^ +/,""))?"partial":"mismatch",dt=async n=>{let t=p.workspace.getConfiguration("copilot"),e=t.get("enable",!0),r=t.get("kindLabel","\uF113\xA0"),s=t.get("priority",1e3),l=t.get("limit",10),o=t.get("enablePreselect",!0),c=t.get("shortcut","Cop"),i=!1,g=[],v=t.get("timeout",5e3),a=t.get("showRemainingText",!0);if(!e)return;await mt(n.extensionPath);let I={async provideCompletionItems(d,G,bt,H){let{option:y}=H,B=null,O=[],Q=y==null?void 0:y.filetype;if(y){let U=p.workspace.nvim.createBuffer(y.bufnr),S=y.input;j.emit("abort");let T=await gt(U,i,S,v);if(!T||T.length===0||(T.forEach(({range:x,insertText:m})=>{let E=d.positionAt(d.offsetAt(G)),R=E.character,X=R-S.length,D=d.getText({start:{line:E.line,character:0},end:E}),Y=S.length===0&&D.trim()==="",C=vt(m,D);if(Y&&(C="partial"),C==="mismatch")return;let L=0;switch(C){default:case"match":{L=0;break}case"partial":{L=R-x.start.character;break}}let J=C==="partial"?E:x.start,Z={line:x.end.line,character:x.end.character+3},tt=m.split(`
`).map((h,w)=>w===0?h.slice(X-L):h).join(`
`).replace(/(\n( ){2,})/g,"\u21B5 ").replace(/\n/g,"\u21B5").replace(/^ +/,""),et=m.split(`
`).map(h=>{var w;return((w=h.match(/^( +)/))==null?void 0:w[0].length)||0}).reduce((h,w)=>Math.min(h,w),1/0),$=m.split(`
`).map(h=>h.replace(new RegExp(`^ {${et}}`),"")).join(`
`),b=m.split(`
`)[0];if(a?b=b.replace(new RegExp(`^.{${R-L}}`),"").replace(/^ +/,""):b="",b=b?`\`\`\`txt
${b}
\`\`\`
***
\``:"",$=b+`\`\`\`${Q}
${$}
\`\`\``,m=C==="partial"?m.replace(new RegExp("^ +"),""):m,y.input.length===0){let h=ht(m,y.line);h>0&&(m=m.slice(h),J.character=h)}O.push({label:tt,kind:r,detail:"",documentation:{kind:p.MarkupKind.Markdown,value:`${$}`},textEdit:p.TextEdit.replace(p.Range.create(J,Z),m),preselect:o})}),!O.length))return null;B={items:O.slice(0,l),isIncomplete:!!i}}return B}};n.subscriptions.push(p.languages.registerCompletionItemProvider("copilot",c,null,I,g,s,void 0,!!i))};0&&(module.exports={activate});
